# 数字图像处理

## 概论

![image-20231008141243782](imgs/1.png)

##  数字图像处理基础

### 人眼视觉感知

* 人眼 <=> 照相机
  * 眼帘 <=> 镜头盖
  * 瞳孔 <=> 光圈
  * 晶状体 <=> 透镜
  * 视网膜 <=> 底片
  * 视神经细胞 <=> 感光药膜
    * 视杆细胞
    * 视锥细胞



* 人眼辨别亮度差别的能力，与环境亮度和本身亮度有关
* 感知亮度并不是实际灰度的简单函数（马赫带效应）



### 图像的感知与获取

图像获取方式：

* 单传感器
* 条传感器
* 传感器阵列



### 图像采样与量化

* 成像模型

  $0<f(x,y)< \infty$

* 连续感知数据->数字形式

* 采样与量化

  * 采样：空间坐标的离散化，决定图像的空间分辨率
  * 量化：图像函数值（幅值）的数字化，光强，决定图像幅度（灰度级）分辨率



* 动态范围、饱和度、对比度
  * $f(x,y):x,y \in Z,f \in Z$



#### 图像数字化：对M、N和离散灰度级数L

* $L=2^k$
* $f \in [0,L-1]$



#### 图像量化

* 均匀量化
* 非均匀量化
  * 基于视觉特性
  * 基于统计特性



#### 空间与灰度分辨率

* 空间分辨率：每英寸点数表示dpi
* 灰度分辨率：用于量化灰度的比特数



* 图像内插（重采样）：调整图像的大小、旋转、几何校正
  * 下采样/收缩：行列删除
  * 上采样/放大：创建新的像素位置，对新位置上的像素赋值

##### 最近邻插值

原图中最近邻的灰度赋给新像素

块效应和马赛克效应

##### 双线性插值

用四个最近邻位置上的灰度值估计给定位置的灰度值

比最近邻插值效果好，没有明显的块效应

计算量比最近邻插值大，使图像细节退化

### 图像的表示与描述

#### 数学表示

二维离散信号：$I=f(x,y)$

$(x,y)$表示图像像素坐标

$f(x,y)$表示在坐标处像素的灰度值

**二维矩阵**

**坐标索引**

矩阵是按照行列的顺序来定位数据的，但是图像是在平面上定位数据的，所以有一个坐标系定义上的特殊性。

**线性索引**

由一个一维的非负整数串组成，通过计算到坐标(0,0)的偏移量得到

行扫描

列扫描

#### 图像描述

##### 灰度图像

图像中的每个像素的信息由一个量化的灰度级来描述，没有色彩信息

灰度图像像素的灰度级通常为8bits，即0~255。“0”表示纯黑色，“255”表示纯白色

##### 黑白图像/二值图像

黑白图像是对灰度图像二值化

图像中的每个像素只能是黑或者白，没有中间的过渡，故又称二值图像，二值图像的像素值为0、1；

对二值图像进一步处理

### 像素间基本关系

像素是图像的基本组成单元，在图像空间中网格化排列

像素间基本关系：

* 相邻像素
* 邻接、连接、连通
* 集合间关系

#### 像素间的距离

p,q坐标为$(x,y),(s,t)$

* 欧氏距离$D_E$

  范数为2的距离

  $D_E(p,q)= \sqrt{(x-s)^2+(y-t)^2}$

* 曼哈顿距离

  $D_4(p,q)=|x-s|+|y-t|$

* 切比雪夫距离

  $D_8(p,q)=max \{|x-s|,|y-t| \}$

测量像素在空间的接近程度

**距离度量函数**定义

设3个像素$p,q,r$，坐标分别为$(x,y),(s,t),(u,v)$，函数D为一个距离度量
函数，其必须满足下列三个条件

1. $D(p,q) \ge 0,D(p,q)=0$当且仅当p=q **像素距离非负**
2. $D(p,q)=D(q,p)$ **像素距离与起终点选择无关**
3. $D(p,r) \le D(p,q)+D(q,r)$ **像素之间的最短距离是直线距离**

#### 邻域

**4-邻域** $N_4(p)$

![image-20231020143239327](imgs/2.png)

**对角邻域** $N_D(p)$

![image-20231020143413854](imgs/3.png)

**8-邻域** $N_8(p)$

![image-20231020143543501](imgs/4.png)

#### 邻接性

V是用于定义邻接的灰度值集合

![image-20231020144228399](imgs/5.png)

**4-邻接**

* q在p的$N_4(p)$中，且都在V中取值
* q在$N_4(p)$中意味着p在$N_4(q)$中

**8-邻接**

* q在p的$N_8(p)$中，且都在V中取值
* q在$N_8(p)$中意味着p在$N_8(q)$中

**m-邻接/混合邻接**

* 都在V中取值，满足下列条件之一：
  1. q在$N_4(p)$中，即p、q是4-邻接
  2. q在$N_D(p)$中，且$N_4(p) \cap N_4(q)=\varnothing$

m-邻接可以认为是8-邻接的一种变形，引进它是为了消除使用8-邻接时，常出现的多路问题。

#### 连通性

像素间的通路：从具有坐标$(x_0,y_0)$的像素$p_0$到具有坐标$(x_n,y_n)$的像素q的一
条通路由一系列具有坐标$(x_0,y_0)$,$(x_1,y_1)$, …, $(x_n,y_n)$的独立像素组成，且满足：

1. $(x_i,y_i)$与$(x_{i-1},y_{i-1})$邻接
2. $1 \le i \le n$，n为通路长度

* 如果$(x_0,y_0)=(x_n,y_n)$，则通路称为闭合通路
* 根据不同的邻接定义，可以得到不同的通路

**像素间的连通**

* $S$表示图像中像素的一个子集
* 如果S中的两个像素p和q之间存在一个完全由S中像素组成的通路（通路上所有像素的灰度值均满足某个特定的相似准则），则像素p和q在S中是连通的
* 连通分量：连通到S中的任何像素p的像素集合
* 连通集： 如果S仅有一个连通分量

#### 区域与边界

令R表示图像中像素的一个子集。若R是一个连通集，称R为图像的一个区域

若$R_i$和$R_j$形成一个连通集时，称$R_i$和$R_j$为邻接区域。

K个不相交的区域$R_k$，$R_u$表示所有K个区域的并集

$R_u$称为图像的前景，$(R_u)^c$为背景

区域的边界也称为区域的轮廓，是该区域的一个子集，但在其邻域中有不属于该区域的元素，它将该区域与其他区域分开

必须**指定所用连接类型**才能确定一个像素是否属于边界

![image-20231020152134446](imgs/6.png)

### 数学工具

#### 阵列与矩阵操作

#### 线性操作与非线性操作

设操作H和两个图像$f(x,y),g(x,y)$对于常数$a_1,a_2$
$$
H[a_1f(x,y)+a_2g(x,y)]=a_1H \cdot f(x,y)+a_2H \cdot g(x,y)
$$
成立，那么称H是线性操作，否则，称为非线性操作

线性操作满足两个法则

1. 比例性/同质：$y=f(x),\forall a,a \cdot y=f(a \cdot x)$
2. 叠加性：$y_1=f(x_1),y_2=f(x_2),y_1+y_2=f(x_1+x_2)$

#### 算术运算

加减乘除

#### 集合运算和逻辑运算

#### 空间运算

#### 图像变换

## 空间域图像增强

### 背景知识

#### 图像增强

对图像进行处理，使其更适合于某种特定的应用

#### 空间域图像增强

图像平面本身，直接对像素进行操作
$$
g(x,y)=T[f(x,y)]
$$
f(x,y)是原图像，g(x,y)是处理后的图像，T是作用域f的操作，定义在(x,y)的邻域

![image-20231027141736840](E:\myNote\DIP\imgs\7.png)

若将邻域大小限制为1*1，简化为点运算$s=T(r)$

![image-20231027142515727](E:\myNote\DIP\imgs\8.png)

对比度拉伸函数、阈值处理函数

#### 变换域图像增强

首先通过某种数学变换把图像转换（如傅立叶变换、小波变换等）到变换域后进行处理，最后再进行逆变换到空间域

### 一些基本的灰度变换函数

计灰度级为$[0,L-1]$

灰度变换

* 常用于改变图象的灰度范围及分布
* 也称为对比度增强、对比度拉伸或灰度变换
* 灰度变换可以是线性的，也可以是非线性（平方、对数、其它任意单调函数）

![img](imgs/9.png)

#### 图像反转变换

$$
s=L-1-r
$$

灰度图像：黑白颠倒

彩色图像：补色

适用于增强图像中**暗色区域**的灰色细节部分

![image-20231027143816771](E:\myNote\DIP\imgs\10.png)

#### 对数变换

$$
s=c\log(1+r)
$$

c为常数，r非负

* 把窄范围的低灰度级映射到宽范围的灰度级 (增强低灰度级)
* 把宽范围的高灰度级映射到窄范围的高灰度级 (抑制高灰度级)
* 压缩图像的动态范围, 显示图像的傅里叶频谱图像等

![image-20231027144111180](E:\myNote\DIP\imgs\11.png)

#### 反对数变换

$$
s=c/\log(1+r)
$$

* 把宽范围的低灰度级映射到窄范围的灰度级 (抑制低灰度级)
* 把窄范围的高灰度级映射到宽范围的低灰度级 (增强高灰度级)

#### 幂次（伽马）变换

$$
s=cr^\gamma,c \gt 0,r >0
$$

* $\gamma <1$​：扩展暗像素值, 压缩亮像素值（提升暗区分辨能力）
* $\gamma >1$：压缩暗像素值, 扩展亮像素值（提升亮区分辨能力）

用于各种图像获取、打印和显示等设备的伽马校正

#### 分段线性变换

将灰度级划归不同范围, 每个范围采用不同的线性变换

* 优点: 变换形式可根据需要任意合成

* 缺点: 需用户输入

* 主要形式:

  * 对比度拉伸

    ![image-20231027151135578](E:\myNote\DIP\imgs\12.png)

    提高图像灰度级的动态范围

  * 灰度级分层(灰度切割)

    提高图像中特定灰度范围的亮度

  * 比特平面分层 (位图切割)

    分析图像每个比特的相对重要性

### 直方图处理

#### 定义

灰度级为$[0,L-1]$范围的数字图像的直方图(Histogram)是离散函数$h(r_k)=n_k(k=0,1,\dots,L-1)$;

* $r_k$是第k级灰度
* $n_k$是图像中灰度级为$r_k$的像素的个数

上述为频次直方图

归一化的直方图，为频率直方图

$h(r_k)=n_k/n(k=0,1,\dots,L-1),\sum_kh(r_k)=1$

![image-20231027152158392](imgs/13.png)

#### 基于直方图的图像增强技术

##### 直方图均衡

将原图像的直方图通过灰度变换函数$s=T(r)$对灰度进行修正，使变换后的图像中各灰度级出现的几率相当, 变换后概率密度函数(PDF)为均匀分布

目的：增加像素灰度值的动态范围，从而达到增强图像整体对比度的效果

1. $r$和$s$为两个随机变量，定义域和值域均为闭区间 $[0,L-1]$, 随机变量$r$服从概率密度函数为$p_r(r)$的分布，随机变量$s$服从均匀分布$p_s(s)$ ，概率密度函数$p_r(r)$和均匀分布$p_s(s)$在区间$[0,L-1]$上连续可微
2. $T(r)$为单调递增函数

$$
p_s(s)\sim U(0,L-1)
$$

$$
p_s(s)=\frac{1}{L-1}
$$

$$
p_s(s)ds=p_r(r)dr
$$

$$
ds=\frac{p_r(r)dr}{p_s(s)}=(L-1)p_r(r)dr
$$

$$
s=T(r)=(L-1) \int_0^r p_r(w)dw
$$

$$
p_r(r_k)=\frac{n_k}{MN},k=0,1,\dots,K-1
$$

$$
s_k=\frac{L-1}{MN}\sum_{j=0}^{k}n+j
$$

