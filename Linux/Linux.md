# Linux

## Linux系统导论

### 操作系统的基本概念

操作系统是硬件之上的**第一层**系统软件。

它是控制、管理计算机系统内各种硬件和软件资源，有效地组织多道程序运行的系统软件（或程序集合）。 

基本职能：

* 控制硬件
* 管理资源
* 提供用户接口
* 处理输入输出
* 监控系统
* 通信

### Linux操作系统的历史、现状及特点

#### Linux的起源

Unix操作系统的出现

1969年，美国贝尔实验室K.Thopson和D.M.Richie开发出了著名的Unix系统

#### Linux简介

Linux是一种类似UNIX的操作系统，与其他商业性操作系统最大的区别在于它的源代码完全公开。
Linux从最初就加入了GNU计划，其软件发行遵循GPL原则，与GNU计划中的其他软件一样都是自由软件(Free Software)。

主要特点

* 开放性
* 真正的多用户多任务
* 良好的兼容性
* 强大的可移植性
* 高度的稳定性和速度性能
* 丰富的网络性能
* 可靠的系统安全

#### Linux的版本

Linux的内核版本号由三个数字组成，一般表示为X.Y.Z的形式。

* X：表示主版本号，通常在一段时间内比较稳定。
* Y：表示次版本号，如果是偶数，代表这个内核版本是正式版本，可以公开发行；如果是奇数，代表这个内核版本是测试版本，还不太稳定仅供测试。
* Z： 表示修改号，这个数字越大，表明修改的次数越多，版本相对更完善。

Linux的发行版本

发行版本没有发布内核的权利，只是将内核以及一些相关软件组合起来而已。发行版本之间的差别主要在于包含的软件种类和数量的不同。

#### 应用现状与前景

* 桌面

  桌面曾经是Linux的弱项，但是随着Linux技术，特别是X Window技术的发展，Linux在界面美观、使用方便等方面有了很大进步，Linux作为桌面操作系统逐渐被用户接受

* 服务器

* 嵌入式系统

  * Linux具有很强的可移植性，支持各种不同的电子产品的硬件平台。
  * Linux内核可以免费获得，并可根据实际需要自由修改，便于嵌入式产品根据需要定制 。
  * Linux功能强大并且内核很小，1MB内存~100KB的内存。
  * Linux支持多种开发语言，如C、C++、Java，为嵌入式系统上的多种应用提供了可能。

* 集群计算机

  * 极高的性价比
    Linux集群计算机的价格是相同性能传统的超级计算机的10%~30%。
  * 极强的可扩展性
    在Linux集群计算机中增加单个的计算机就能增加整个集群的计算能力，并不需要淘汰原来的计算机设备。

#### Linux的各组成部分

广义的Linux各组成部分

![image-20240226213233454](E:\myNote\Linux\imgs\1.png)

* 内核

  内核（Kernel）是整个操作系统的核心，内核控制整个计算机的运行，提供相应的硬件驱动程序、网络接口程序，并管理所有应用程序的执行。

  Linux内核的源代码主要用C语言编写，只有与驱动相关的部分用汇编语言编写。

  采用模块化的结构，其主要模块包括：

  * 存储管理
  * 文件系统管理
  * 网络通信
  * 系统调用
  * CPU和进程管理
  * 设备管理和驱动
  * 系统的引导

* Shell

  * Linux内核并不能直接接受来自终端的用户命令，也就是不能直接与用户进行交互操作，这就需要Shell这一交互式命令解释程序来充当用户和内核之间的桥梁。
  * Shell负责将用户的命令解释为内核能够接受的低级语言，并将操作系统相应的信息以用户能够理解的方式显示出来。
  * Linux中可使用的Shell有很多，Linux的各发行版本皆能同时提供两种以上的Shell共用户自行选择使用
  * Shell 不仅是一种交互式命令解释程序，还是一种程序设计语言。
  * 它与MS DOS中的批处理命令类似，但比批处理命令功能强大。
  * 在Shell脚本程序中可以定义和使用变量，进行参数传递、流程控制、函数调用等。

* 应用程序

  * Linux环境下可使用的应用程序种类丰富，数量繁多。
  * 运行：字符界面或X Window图形化用户界面。
  * Linux的应用程序主要来源：
    * 专门为Linux开发的应用程序，如GAIM、OpenOffice等。
    * UNIX的应用程序移植到Linux，如vi。
    * Windows的应用程序移植到Linux，如RealOne播放器、Oracle。

### Linux操作系统的安装

### Linux系统图形界面的一般知识

#### X Windows

* X窗口系统(X Window System，也常称为X11或X)是一种以位图方式显示的软件窗口系统。
* 最初是1984年麻省理工学院的研究，之后变成UNIX、类UNIX、以及OpenVMS等操作系统所一致适用的标准化软件工具包及显示架构的运作协定。
* X窗口系统通过软件工具及架构协定来创建操作系统所用的图形用户界面。       

X Window的客户-服务器模型

![image-20240226213701042](E:\myNote\Linux\imgs\2.png)

* X 服务程序：也称显示管理器，是控制实际显示设备和输入设备的程序。它响应X客户程序的请求，直接与图形设备通信，负责打开和关闭窗口，控制字体和颜色等底层的具体操作。每个显示设备只有一个唯一的X服务程序。
* X客户程序：是使用系统窗口功能的一些应用程序。X客户程序无法直接影响窗口或显示，他们只能请求X服务程序，并通过X服务程序提供的服务在制定的窗口中完成特定的操作。

#### 桌面系统

GNOME提供了一个简单和经典的桌面体验，它没有足够的自定义选项。 Gnome 是 Fedora 的默认桌面环境，Ubuntu，Debian，OpenSUSE 等都可以选用。   

KDE

Unity

## Shell命令

### Linux系统基础概念

#### 终端

在Linux系统中，普通用户是通过一台终端机来和主机系统进行信息通讯的，用户的终端机上可以安装LINUX系统，也能安装其他类型的操作系统如windows系统。

![image-20240226214202198](E:\myNote\Linux\imgs\3.png)

* 在控制台上进行登录
* 在终端上进行登录，在用户的本机系统上用合适的应用程序进行登录
* 在已登录状态下，使用命令：logout 或者 exit 或者Ctrl-d 进行注销，注销后本地应用程序和LINUX主机之间的连接被断开。

#### 账户

* LINUX系统是一个分时多用户系统，系统以"帐户"为基础，构建出了多用户的工作环境。

* 在LINUX系统中有一个名为/etc/passwd的文件，该文件存放了系统用户的信息，每个授权用户在文件中占有一个记录项。

  ![image-20240226215447505](E:\myNote\Linux\imgs\4.png)

* 在大部分LINUX系统中使用了/etc/shadow文件进行用户的口令管理，格式和帐户文件大致类似。

  ![image-20240226215542606](E:\myNote\Linux\imgs\5.png)


#### 用户组

各个用户组的信息都保存在LINUX系统中的文件/etc/group中

![image-20240229212812944](E:\myNote\Linux\imgs\6.png)

### Linux系统的启动过程

#### 启动方式

多用户模式   , 单用户模式 等多级启动模式

#### 运行级别

* 停机。不要把系统的默认级别设置为0，否则系统不能正常启动。
* 用户模式。用于root用户对系统进行维护，不允许其他用户使用主机。
* 多用户模式。在该模式下不能使用NFS。
* 完全多用户模式。主机作为服务器时通常在该模式下。
* 未分配使用。
* 图形登陆的多用户模式。用户在该模式下可以进行图形界面的登陆。
* 重新启动。不要把系统的默认级别设置为6，否则不能正常启动。



![image-20240229213853771](E:\myNote\Linux\imgs\7.png)

#### 第一部分：内核的引导

几个重要文件：bootsect.S、setup.S、video.S等

1. bootsect.S:生成引导扇区的汇编源码

2. setup.S:将系统参数（包括内存、磁盘等，由BIOS返回）拷贝到特别内存中，以便以后这些参数被保护模式下的代码来读取。此外，setup.S还将video.S中的代码包含进来，检测和设置显示器和显示模式。

3. setup.S:将系统转换到保护模式，并跳转到 0x100000。0x100000这个内存地址存放的是解压后的内核

4. 当CPU跳到0x100000时，将执行“arch/i386/kernel/head.S”中的startup_32函数，它也是vmlinux的入口，然后就跳转到start_kernel()中。

   start_kernel()函数

   * start_kernel()是“init/main.c”中的定义的函数
   * start_kernel()中调用了一系列初始化函数，以完成kernel本身的设置。
   * start_kernel()函数中做了大量的工作来建立基本的 Linux核心环境。
   * 如果顺利执行完start_kernel()，则基本的Linux核心环境已经建立起来了。
   * 在start_kernel()的最后，通过调用init()函数，系统创建第一个核心进程，启动了init进程。 

#### 第二部分：运行init程序

核心线程init

* 外设初始化的工作：包括调用do_basic_setup()完成外设及其驱动程序的加载和初始化，并完成文件系统初始化和root文件系统的安装。 
* 打开了/dev/console设备，重定向三个标准的输入输出文件stdin、stdout和stderr到控制台
* 最后，搜索文件系统中的init程序并使用 execve()系统调用加载执行init程序。

Linux在完成核内引导以后，就开始运行init程序。init的进程号是1，**init进程是系统所有进程的起点。**

init程序需要读取配置文件/etc/inittab。inittab是一个不可执行的文本文件，它有若干行指令所组成。

#### 第三部分：系统初始化

调用执行/etc/rc.d/rc.sysinit脚本

完成一些系统初始化的工作，包括激活交换分区，检查磁盘，加载硬件模块以及其它一些需要优先执行任务。

#### 第四部分：启动对应运行级别的守护进程

rc.sysinit执行后，返回init继续其它的动作，通常接下来会执行到/etc/rc.d/rc程序。

l5:5:wait:/etc/rc.d/rc 5

以5为参数运行/etc/rc.d/rc5.d目录下的所有的rc启动脚本

S开头的启动脚本：将以start参数来运行。

K打头的链接：已经处于运行态，则将首先以stop为参数停止这些已经启动了的守护进程，然后再重新运行。

#### 第五部分：登陆系统，启动完成

* 进入mingetty登录界面时，输入用户名和密码来登录系统。
* login程序接收mingetty传来的用户名作为用户名参数。然后搜索/etc/passwd以及/etc/shadow来验证密码以及设置账户的其它信息。
* login程序成功后，向对应的终端再输出最近一次登录的信息(在/var/log/lastlog中有记录)，并检查用户是否有新邮件(在/usr/spool/mail/的对应用户名目录下)
* 配置文件执行后，各种环境变量也设好，出现命令行提示符，整个启动过程结束。

### Linux系统的Shell

* shell是LINUX系统与用户进行交互的接口，从功能上来说，和windwos系统的外壳程序cmd是相同的。 
* shell是一种命令解释程序(命令解释器)
* shell解释用户输入的命令行，提交系统内核处理，并将结果返回给用户。一旦用户注册到系统后，shell就被系统装入内存，并一直运行到用户退出系统为止。
* shell本身也是一种可编程的程序设计语言
* 用shell写的程序(shell脚本)相当于dos/windows下的批处理文件，它可以简单到只有一条命令，也可以复杂到包括大量循环、条件语句、数学运算、控制结构，也可以是介于两者之间的程序。

shell程序是LINUX系统的外壳程序，在LINUX系统的发展过程中出现过多种风格的shell程序，其中最常见的有B-shell, K-shell和C-shell。

* bash是Linux系统默认使用的shell，内部命令一共有40个,并且在每种 LINUX 上都可以使用。BShell 在 Shell 编程方面相当优秀，但在处理与用户的交互方面作得不如其他几种 Shell
* csh是Linux比较大的内核，共有52个内部命令。它更多的考虑了用户界面的友好性，普遍认为C shell 的编程接口做的不如 BShell，但 C Shell 还是被很多 C 程序员使用，因为 C Shell 的语法和 C 语言很相似
* ksh是Korn shell的缩写，共有42条内部命令。它集合了 C Shell 和 B Shell 的优点并且和 B Shell 完全兼容。
* dash shell是作为Debian Linux发行版的一部分开发的，主要出现在Ubuntu Linux发行版中。它是Bourne shell的精简版，支持的功能不像bash shell支持的那样多，这可能会给脚本编程带来一些问题。
* ash shell是Linux中占用系统资源最少的一个小shell，它只包含24个内部命令，因而使用起来很不方便。
* zsh（Z shell）是另一个流行的shell，是由Paul Falstad开发的开源Unix shell。它集成了所有现有shell的思想并增加了许多独到的功能，包含84个内部命令为程序员创建了一个全功能的高级shell。zsh shell具有三大功能：改进的shell选项处理、shell兼容性模式以及可加载模块。其中，可加载模块是shell设计中最先进的功能。



在/etc/passwd文件中指定要启动的shell

命令行状态下的交互shell启动

在系统中可能有多种版本的shell存在,可通过相应的命令来启动

### 常用Shell命令

